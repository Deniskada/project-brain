# Project Brain — Статус (09.11.2025)

## Резюме
- **Назначение:** локальная база знаний и RAG-ассистент для проектов StaffProBot.
- **Текущий фокус:** доведение фазы 5 (датасеты и улучшение качества поиска) и эксплуатация готового функционала (фазы 1–4,6).
- **Последнее обновление:** переход на синхронный `chromadb.HttpClient`, исправление `/api/index/status/*`, стабильная переиндексация после webhook.

## Прогресс по фазам
| Фаза | Описание | Статус | Комментарий |
|------|----------|--------|-------------|
| 1 | Инфраструктура, индексаторы, Docker окружение | ✅ Завершена | Python/Markdown индексаторы, ChromaDB + Redis конфигурация |
| 2 | RAG Engine и основные API | ✅ Завершена | `/api/query`, `/api/index/*`, health, intent detection |
| 3 | Веб-интерфейс чата и UX | ✅ Завершена | `http://localhost:8003/chat` (селектор проектов, источники) |
| 3.5 | Тесты качества RAG | ✅ Завершена | Автотесты, набор примерных запросов |
| 4 | Генерация документации | ✅ Завершена | `/api/documentation/generate`, три аудитории, UI `/docs` |
| 5 | Датасеты RAG (FAQ/bugs/changelog) | ⚠️ В работе (~40%) | каркас и API готовы, требуется наполнить коллекции и включить эмбеддинги |
| 6 | GitHub auto-update и CI/CD | ✅ Основные функции | Webhook реализован, требуется финальная настройка в GitHub |

## Ключевые достижения
- Постоянная коллекция `kb_staffprobot` (720 документов) с уникальными `chunk_id` и приоритетом по типу (`route`, `model`, `service`).
- RAG-движок использует `qwen2.5:14b-instruct`, промпты против галлюцинаций и определение намерений (how_to/structure/api/overview).
- Генератор документации формирует отчёты для разработчиков, администраторов и пользователей за ~10 секунд.
- Автообновление: `/api/webhook/github` обрабатывает push-события (HMAC, BackgroundTasks), ручные триггеры `/api/webhook/manual-reindex/{project}`.
- Метрики и health endpoints ( `/api/stats`, `/api/stats/staffprobot`, `/health` ) предоставляют данные для мониторинга.

## Метрики (09.11.2025)
- **Активные проекты:** 1 (`staffprobot`).
- **ChromaDB:**
  - `kb_staffprobot` — 720 документов, 106 уникальных файлов.
  - `commit_history` — 105 записей (через `/api/datasets/sync`).
- **LLM:** `qwen2.5:14b-instruct`, среднее время генерации ответа 8–12 секунд.
- **Инфраструктура:** Docker Compose (`api`, `chromadb`, `redis`), Ollama на хосте.

## Следующие шаги
1. **Фаза 5:**
   - Добавить реальные данные FAQ/bugs/changelog (через `/api/datasets/sync`).
   - Подключить эмбеддинги для специализированных коллекций и включить rerank.
   - Включить кэширование популярных запросов.
2. **Качество поиска:**
   - Расширить метаданные (теги, категории) и прогонить тестовый набор запросов.
   - Сформировать регулярный отчёт по качеству (см. `tests/test_staffprobot_queries.json`).
3. **Автообновление:**
   - Настроить вебхуки в GitHub (см. `docs/GITHUB_AUTO_UPDATE_GUIDE.md`).
   - Добавить уведомления о статусе переиндексации (Telegram/Slack, опционально).

## Хронология
- **09.11.2025** — переход на `chromadb.HttpClient`, починка `/api/index/status/*`, стабильная переиндексация.
- **16.10.2025** — завершена генерация документации, внедрён UI `/docs`.
- **13.10.2025** — финализация RAG-движка и веб-чата, настройка Ollama (GPU).

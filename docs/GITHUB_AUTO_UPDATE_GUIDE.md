# üîÑ GitHub Auto-Update: –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üéØ –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç?

–ü—Ä–∏ –∫–∞–∂–¥–æ–º `git push` –≤ `main/master`:
1. ‚úÖ –ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (`git pull`)
2. ‚úÖ –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ ChromaDB
3. ‚úÖ RAG –æ—Ç–≤–µ—á–∞–µ—Ç —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
4. ‚úÖ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –≤—Å–µ–≥–¥–∞ –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏

**–í—Ä–µ–º—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:** ~30-60 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

---

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (1 —Ä–∞–∑)
> –í—Å–µ –ø—Ä–∏–º–µ—Ä—ã –Ω–∏–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `http://localhost:8003`. –ü—Ä–∏ –≤–Ω–µ—à–Ω–µ–º –¥–æ—Å—Ç—É–ø–µ –∑–∞–º–µ–Ω–∏—Ç–µ `localhost` –Ω–∞ –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ (`<HOST>`).

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ ‚úÖ

–í—Å—ë —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ:
- ‚úÖ `.env` —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω —Å —Å–µ–∫—Ä–µ—Ç–æ–º
- ‚úÖ `config/projects.yaml` –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Webhook endpoint –≥–æ—Ç–æ–≤: `/api/webhook/github`
- ‚úÖ API —Å—Ç–∞—Ç—É—Å–∞ –≥–æ—Ç–æ–≤: `/api/webhook/status`

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –≤ GitHub

#### –î–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è StaffProBot:

1. –û—Ç–∫—Ä—ã—Ç—å: https://github.com/Deniskada/staffprobot/settings/hooks

2. –ù–∞–∂–∞—Ç—å **"Add webhook"**

3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É:

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **Payload URL** | `http://<HOST>:8003/api/webhook/github` (–ª–æ–∫–∞–ª—å–Ω–æ `http://localhost:8003/api/webhook/github`) |
| **Content type** | `application/json` |
| **Secret** | –∑–Ω–∞—á–µ–Ω–∏–µ `GITHUB_WEBHOOK_SECRET` –∏–∑ `.env` |
| **Which events?** | ‚úÖ Just the push event |
| **Active** | ‚úÖ Enabled |

4. –ù–∞–∂–∞—Ç—å **"Add webhook"**

5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å - –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è ‚úÖ –∑–µ–ª—ë–Ω–∞—è –≥–∞–ª–æ—á–∫–∞

#### –î–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Project-Brain (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ –∂–µ —à–∞–≥–∏ –¥–ª—è: https://github.com/Deniskada/project-brain/settings/hooks

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoint:

```bash
curl http://localhost:8003/api/webhook/test
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "message": "Webhook API —Ä–∞–±–æ—Ç–∞–µ—Ç!",
  "endpoints": {
    "github": "/api/webhook/github"
  }
}
```

### 2. –†—É—á–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è (–¥–ª—è —Ç–µ—Å—Ç–∞):

```bash
curl -X POST http://localhost:8003/api/webhook/manual-reindex/staffprobot
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "status": "accepted",
  "message": "Reindexing staffprobot started in background"
}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:

```bash
# –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã
curl http://localhost:8003/api/webhook/status

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
curl http://localhost:8003/api/webhook/status/staffprobot
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "status": "ok",
  "project": "staffprobot",
  "indexing": {
    "status": "completed",
    "started_at": "2025-10-17T10:30:00",
    "completed_at": "2025-10-17T10:30:45",
    "ref": "refs/heads/main",
    "commits_count": 3,
    "stats": {
      "total_files": 156,
      "total_chunks": 2341,
      "errors": 0
    },
    "message": "–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
  }
}
```

### 4. –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–º–∏—Ç:

```bash
cd /home/sa/projects/staffprobot

# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
echo "# Test webhook" > test_webhook.md

# –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å
git add test_webhook.md
git commit -m "–¢–µ—Å—Ç: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏"
git push origin main
```

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

–°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
cd /home/sa/projects/project-brain
docker compose -f docker-compose.local.yml logs api -f | grep -E "GitHub|–∏–Ω–¥–µ–∫—Å|–ò–Ω–¥–µ–∫—Å"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
üîÑ GitHub Push: staffprobot, ref: refs/heads/main, commits: 1
üöÄ –ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–ª—è staffprobot
üì• –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞: git pull –≤ /home/sa/projects/staffprobot
‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω: Already up to date.
üìö –ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞: staffprobot
...
‚úÖ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: {'total_files': 156, 'total_chunks': 2341, 'errors': 0}
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ GitHub

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook:

1. –û—Ç–∫—Ä—ã—Ç—å: https://github.com/Deniskada/staffprobot/settings/hooks
2. –ù–∞–∂–∞—Ç—å –Ω–∞ URL webhook
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ **"Recent Deliveries"**
4. –£–≤–∏–¥–µ—Ç—å:
   - ‚úÖ **Response 200** - —É—Å–ø–µ—à–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
   - üìã **Request/Response** - –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞

---

## üéØ Workflow –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –û–±—ã—á–Ω—ã–π workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

```bash
# 1. –†–∞–±–æ—Ç–∞–µ—Ç–µ –Ω–∞–¥ –∫–æ–¥–æ–º StaffProBot
cd /home/sa/projects/staffprobot

# 2. –í–Ω–æ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
vim apps/web/routes/owner/objects.py

# 3. –ö–æ–º–º–∏—Ç–∏—Ç–µ –∏ –ø—É—à–∏—Ç–µ (–ö–ê–ö –û–ë–´–ß–ù–û!)
git add .
git commit -m "–î–æ–±–∞–≤–ª–µ–Ω–æ: –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª"
git push origin main

# 4. –í–°–Å! –ë–æ–ª—å—à–µ –ù–ò–ß–ï–ì–û –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
# GitHub webhook –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
#   ‚Üí –û–±–Ω–æ–≤–∏—Ç –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
#   ‚Üí –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç
#   ‚Üí –û–±–Ω–æ–≤–∏—Ç –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å:

```bash
# –ß–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ push
curl http://localhost:8003/api/webhook/status/staffprobot

# –ò–ª–∏ –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø—Ä–æ –Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
curl -X POST http://localhost:8003/api/query \
  -H "Content-Type: application/json" \
  -d '{"query": "—Ä–∞—Å—Å–∫–∞–∂–∏ –æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –∫–æ–¥–µ"}'
```

---

## üö® Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Webhook –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 1:** –°—Ç–∞—Ç—É—Å webhook –≤ GitHub
```
GitHub ‚Üí Settings ‚Üí Webhooks ‚Üí Recent Deliveries
‚Üí –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å ‚úÖ –∑–µ–ª—ë–Ω–∞—è –≥–∞–ª–æ—á–∫–∞
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 2:** Project Brain –∑–∞–ø—É—â–µ–Ω
```bash
cd /home/sa/projects/project-brain
docker compose -f docker-compose.local.yml ps
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä 'api' –≤ —Å—Ç–∞—Ç—É—Å–µ 'Up'
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 3:** Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω
```bash
curl http://localhost:8003/api/webhook/test
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
docker compose -f docker-compose.local.yml logs api --tail 100 | grep -E "GitHub|ERROR"
```

**–ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- ‚ùå Push –Ω–µ –≤ `main/master` (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å ref)
- ‚ùå –ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ `project_map` (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è)
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –≤ `config/projects.yaml`

### –ü—Ä–æ–±–ª–µ–º–∞: Git pull failed

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø
cd /home/sa/projects/staffprobot
git pull origin main

# –ï—Å–ª–∏ –ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SSH –∫–ª—é—á–∏ –∏–ª–∏ HTTPS token
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –º–µ–¥–ª–µ–Ω–Ω–∞—è

**–ù–æ—Ä–º–∞:**
- –ú–∞–ª—ã–π –ø—Ä–æ–µ–∫—Ç (< 100 —Ñ–∞–π–ª–æ–≤): 10-20 —Å–µ–∫—É–Ω–¥
- –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–µ–∫—Ç (100-300 —Ñ–∞–π–ª–æ–≤): 30-60 —Å–µ–∫—É–Ω–¥
- –ë–æ–ª—å—à–æ–π –ø—Ä–æ–µ–∫—Ç (> 300 —Ñ–∞–π–ª–æ–≤): 1-3 –º–∏–Ω—É—Ç—ã

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –≤ `exclude_patterns` –≤ `config/projects.yaml`
- –ò—Å–∫–ª—é—á–∏—Ç—å `tests/`, `migrations/`, `scripts/`

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–π:

```bash
curl http://localhost:8003/api/webhook/status | jq
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
curl http://localhost:8003/api/webhook/status/staffprobot | jq
```

### –ò—Å—Ç–æ—Ä–∏—è –≤ GitHub:

```
https://github.com/Deniskada/staffprobot/settings/hooks
‚Üí –ù–∞–∂–∞—Ç—å –Ω–∞ webhook
‚Üí Recent Deliveries
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ–∫—Ä–µ—Ç:** `GITHUB_WEBHOOK_SECRET`  
‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ HMAC-SHA256:** –≤–∫–ª—é—á–µ–Ω–∞  
‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏:** –¥–∞

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:

1. –ü–æ–¥–ø–∏—Å—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-Hub-Signature-256`
2. HMAC-SHA256 —Å —Å–µ–∫—Ä–µ—Ç–æ–º –∏–∑ `.env`
3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `hmac.compare_digest()` (–∑–∞—â–∏—Ç–∞ –æ—Ç timing attacks)

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** –ø—Ä–∏ –∫–∞–∂–¥–æ–º push!

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

**–î–æ:**
```bash
# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞
git push
# –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é:
python scripts/reindex.py  # ‚Üê –ë–û–õ–¨–®–ï –ù–ï –ù–£–ñ–ù–û!
```

**–ü–æ—Å–ª–µ:**
```bash
# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞
git push
# –í–°–Å! –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è!
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ webhook —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://localhost:8003/api/webhook/test

# –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
curl http://localhost:8003/api/webhook/status/staffprobot

# –†—É—á–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
curl -X POST http://localhost:8003/api/webhook/manual-reindex/staffprobot

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
cd /home/sa/projects/project-brain
docker compose -f docker-compose.local.yml logs api -f
```

---

**–í–æ–ø—Ä–æ—Å—ã?** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Troubleshooting –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ `/chat`.

